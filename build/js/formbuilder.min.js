function insertOption(t){var o=document.getElementById("drop"+t),e=document.createElement("option");e.text=prompt("Name your option"),dropOptions[t]||(dropOptions[t]=[]),"null"!==e.text&&e.text&&(o.add(e),dropOptions[t].push(e))}function removeOption(t){var o=document.getElementById("drop"+t),e=o.options[o.selectedIndex].text,n=confirm("Are you sure?");if(n)for(o.remove(o.selectedIndex),i=0;i<dropOptions[t].length;i++)dropOptions[t][i].text===e&&dropOptions[t].splice(i,1)}var dropOptions=[],dropCounter=0,flag=!1;$(document).ready(function(){function t(){var t=1;$("#buildyourform div").each(function(){$(this).attr("id",t.toString()),t++})}function o(o,i){var r,l,d=$("#buildyourform div").length+1,p=$('<div class="fieldwrapper" id="'+d+'"/>');r=o?$('<input type="text" class="fieldname form-control col-xs-4" value="'+o+'" class="fieldname" />'):$('<input type="text" class="fieldname form-control col-xs-4" />'),l="dropdown"===i?$('<select class="fieldtype form-control col-xs-3"> <option selected="selected" value="dropdown">Drop</option> <option value="textbox">Text</option></select>'):$('<select class="fieldtype form-control col-xs-3"><option selected="dropdown" value="textbox">Text</option><option value="dropdown">Drop</option> </select>');var a=$('<button type="button" class="remove btn btn-default btn-danger col-xs-1s" aria-label="Left Align"><span class="glyphicon glyphicon-remove white" aria-hidden="true"></span></button>');a.click(function(){var o=confirm("Are you sure?");if(o){var e=$(this).parent().attr("id");n(e,i),$(this).parent().remove(),t(),n()}}),p.append(r),p.append(l),p.append(a),$("#buildyourform").append(p),l.change(function(){e($(this).parent().attr("id")),n()}),r.on("input",function(){n()}),n()}function e(t){var o=0,e=0;$("#buildyourform div").each(function(){switch($(this).find("select.fieldtype").first().val()){case"textbox":o++,o.toString()===t&&(e++,dropOptions.splice(e,1));break;case"dropdown":o++,e++}})}function n(t,o){$("#yourform").remove();var e=0,n=0,r=$('<fieldset id="yourform"><legend>Your Form</legend></fieldset>');for($("#buildyourform div").each(function(){var o,i="input"+$(this).attr("id").replace("field",""),l=$('<label class="col-md-4" for="'+i+'">'+$(this).find("input.fieldname").first().val()+"</label>");switch($(this).find("select.fieldtype").first().val()){case"textbox":e++,o=$('<div class="previewForm col-md-8"><input class="form-control" type="text" id="'+i+'" name="'+i+'" /></div>');break;case"dropdown":n++,e++,void 0!==t&&e.toString()===t.toString()&&dropOptions.splice(n,1),o=$('<div class="previewForm col-md-8"><select class="form-control" id="drop'+n+'">  </select> <button class="btn btn-default" type="button" onclick="insertOption('+n+')">Insert option</button> <button class="btn btn-default btn-danger" type="button" onclick="removeOption('+n+')">Remove option</button></div>')}r.append(l),r.append(o)}),$("body").append(r),i=1;i<=n;i++)if(void 0!==dropOptions[i])for(j=0;j<dropOptions[i].length;j++)x=document.getElementById("drop"+i.toString()),x.add(dropOptions[i][j]);$("#formContent").append(r)}function r(t){flag=!0;var o={},e='<form class="form-horizontal" method="post" action="#" enctype="application/x-www-form-urlencoded">';_.each(t.fields,function(t,n){e+=l(t,n,o)}),e+="</form>"}function l(t,e,n){var i="_"+e,r='<div class="form-group">';return r+='<label for="'+i+'" class="col-md-2 control-label">'+t.label+"</label>",r+='<div class="col-md-10">',"textfield"===t.type?(r+=p(i,n),o(t.label,t.type)):"dropdown"===t.type&&(dropCounter++,r+=d(t.options,i,n),o(t.label,t.type)),r+="</div>",r+="</div>"}function d(t,o,e){var n='<select class="form-control" name="'+o+'" id="'+o+'">';return _.each(t,function(t){var i=document.createElement("option");dropOptions[dropCounter]||(dropOptions[dropCounter]=[]),i.text=t,dropOptions[dropCounter].push(i),n+='<option value="'+t+'" '+(e[o]===t?"selected":"")+">"+t+"</option> "}),n+="</select>"}function p(t,o){return'<input type="text" class="form-control" name="'+t+'" id="'+t+'"value="'+(o[t]||"")+'">'}null!=form&&r(form),$("#add").click(function(){o()}),$("#submit").click(function(){var t={business:findID,fields:[]},o=0,e=$("fieldset");e.children().each(function(){if($(this).find("select.fieldtype").first().val())if("dropdown"===$(this).find("select.fieldtype").first().val()){var e=$(this).find("input.fieldname").first().val(),n={type:"dropdown",label:e,options:[]};o++;var i=$("#drop"+o+" option");$.map(i,function(t){n.options.push(t.value)}),t.fields.push(n)}else t.fields.push({type:"textfield",label:$(this).find("input.fieldname").first().val()})}),flag?$.ajax({url:"/api/form",type:"PUT",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(){alert("Form Updated!")}}):$.ajax({url:"/api/form",type:"POST",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(){alert("Form Submitted!")}})})});